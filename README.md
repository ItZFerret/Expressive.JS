# My AI Framework — Documentation

This document explains how to describe a website in plain English (`app.txt`) so the framework compiles it into an Express app using LLM tool calls.

## Concepts

- **Plain English Source**: You write `app.txt` describing the site.
- **LLM Compiler**: On startup, the framework asks an LLM to produce a sequence of tool calls that configure the app.
- **Runtime Tools**: The framework executes those tools to build routes and pages.
- **Layouts**: Shared header/footer HTML that wraps every page.
- **Hot Reload**: Saving `app.txt` restarts the server and recompiles quickly.
- **Cache**: The compiled tool plan is cached at `.cache/compiled-plan.json` to avoid repeated LLM calls.

## Available Tools

The LLM calls these tools internally. You don’t call them directly; instead, describe your intent in `app.txt` using the “LLM keywords” below.

- set_layout({ header_html, footer_html })
  - Defines a shared wrapper applied to every page when serving.
  - Use this to avoid duplicating header/footer in each page.
  - Describe the header and footer in plain English in `app.txt`; the LLM will generate the actual HTML for these arguments.
  - Args:
    - header_html: string (HTML fragment generated by the LLM from your plain-English description)
    - footer_html: string (HTML fragment generated by the LLM from your plain-English description)

- create_page({ path, content })
  - Creates a page at a URL path with BODY-only content described in plain English (the LLM will produce HTML).
  - Args:
    - path: string (e.g., "/" or "/about")
    - content: string (BODY content described in plain English; do not include the shared header/footer)

- add_dynamic_content({ path, placeholder, type })
  - Marks a placeholder to be replaced at request time.
  - Supported type(s): CURRENT_TIME
  - Args:
    - path: string (target page path)
    - placeholder: string (exact text, e.g., "{{CURRENT_TIME}}")
    - type: string (currently only "CURRENT_TIME")

- add_asset({ path, asset, alt, placement, placeholder, className, width, height })
  - Inserts an asset (e.g., an image) from the local `assets/` directory into a page BODY. Describe intent in plain English; the tool will generate the `<img>` tag.
  - Files live under `assets/` and are served at `/assets` (e.g., `assets/images/test.png` → `/assets/images/test.png`). The compiler provides the LLM with an inventory of available assets.
  - Args:
    - path: string (target page path)
    - asset: string (file name or relative path under `assets/`, e.g., `test.png` or `images/test.png`)
    - alt: string (plain-English alt text)
    - placement: 'append' | 'prepend' | 'replace_placeholder' (default: 'append')
    - placeholder: string (used when placement is 'replace_placeholder')
    - className: string (optional CSS class)
    - width, height: string (optional)

## Rendering Model

For each request:
1) The page’s BODY (`content`) is used.
2) Any placeholders defined via `add_dynamic_content` are replaced.
3) If a layout was set, the response is composed as: `layout.header_html + body + layout.footer_html`.

If no layout is set, the page’s body is served as-is. Static files under `assets/` are served at `/assets/...`.

## LLM Keywords for `app.txt`

These phrases help steer the LLM to the correct tool calls:

- Layouts
  - "Use a shared layout across all pages"
  - "Define header and footer via set_layout"
  - "The header should declare a standard HTML5 document, use UTF-8, set the title, and begin the body with a top navigation bar"
  - "Open the body in the header and close it in the footer; the footer should end the document and may include a footer note"

- Pages (Body-only)
  - "Create PAGE BODY content only using create_page"
  - "Do not repeat the header or footer in page content"
  - "Mount the home page at / and About at /about"

- Assets
  - "Add the test.png image from the assets/images folder to the hero section at the top of the home page"
  - "Use alt text: A friendly test image"
  - "If needed, replace the placeholder {{HERO_SECTION}} with the image"

- Dynamic placeholders
  - "Include a placeholder {{CURRENT_TIME}} in the home page"
  - "Mark {{CURRENT_TIME}} as dynamic using add_dynamic_content with type CURRENT_TIME"

- General
  - "Use tool calls only" (the system prompt enforces this, but reinforcing helps)
  - "Use tool_choice auto"

## Example `app.txt`

```text
Create a simple two-page website with a shared layout.

Use set_layout to define the shared wrapper:
- The header should declare a standard HTML5 document, use UTF-8, set the title "My Site", and start the body with a simple top navigation bar.
- The footer should close the body and end the document, and may include a short footer note.

Then create two pages using create_page with BODY content only:
- At path "/": include a Welcome header and a paragraph with the current time placeholder {{CURRENT_TIME}}.
- At path "/about": include an About Us header and a short paragraph.

Add the image "test.png" from the assets/images folder to the hero area at the top of the home page. Use alt text "A friendly test image".

Mark the home page’s {{CURRENT_TIME}} placeholder as dynamic using add_dynamic_content with type CURRENT_TIME.
```

The LLM will translate this into tool calls to set the layout, create both pages (BODY content only), and mark the dynamic placeholder.

## Hot Reload & Cache

- Hot reload: Save `app.txt` and the server will restart + recompile automatically.
- Cache: After the first successful compile, restarts use `.cache/compiled-plan.json` if `app.txt` and the assets inventory haven’t changed, skipping network calls and allowing offline runs.
- To force a fresh compile: edit `app.txt` or delete `.cache/compiled-plan.json`.

## Troubleshooting

- No layout applied:
  - Ensure `app.txt` clearly asks to "Use set_layout" and to keep page content BODY-only.
- Doubled HTML tags:
  - If page content includes full HTML (<html>, <body>) and a layout is also set, tags may appear duplicated. Ask for BODY-only in `create_page` content.
- Stale cache:
  - Delete `.cache/compiled-plan.json` or change `app.txt`.
- Missing or invalid API key:
  - Put your key in `config.json` or use the environment fallback.
 - Asset not appearing:
   - Ensure the file exists under `assets/` (e.g., `assets/images/test.png`). The public URL is `/assets/images/test.png`.

## Limitations (PoC)

- Only GET routes and static HTML (with simple dynamic placeholders).
- Only the CURRENT_TIME dynamic type is supported.
- No client-side bundling or asset pipeline yet.

## Roadmap Ideas

- Additional tools: serve_static, fetch_data, add_form, add_styles
- Simple templating (partials/slots)
- JSON Schema validation of tool args at runtime
- Test suite and LLM mocking
- CLI: myai build/dev/inspect
